<!DOCTYPE html>
<html>

<head>
    <title>Grants 4 all</title>
    <link rel="stylesheet" href="./css/colour.css">
    <link rel="stylesheet" href="./css/images.css">
    <link rel="stylesheet" href="./css/state.css">
    <link rel="stylesheet" href="./css/typography.css">
    <link rel="stylesheet" href="./css/structure.css">
    <script>

        document.addEventListener("login", e => {

            const bodyClassList = document.body.classList;
            const accountNameElements = document.querySelectorAll(".account-name");
            bodyClassList.remove("logged-in");
            bodyClassList.remove("login-error")
            const account = e.detail?.account;
            const err = e.detail?.err;
            if (err) {
                bodyClassList.add("login-error");
                alert(err);
            } else {
                let accountName = "";
                if (account) {
                    bodyClassList.add("logged-in");
                    accountName = account.givenName ? `${account.givenName} ${account.familyName}` : account.username
                } else {
                    bodyClassList.add("logged-out");
                }
                for (let element of accountNameElements) {
                    element.textContent = accountName;
                }
            }

        });
    </script>
    <script type="module">
        import { signIn, signOut } from "./js/auth.js";
        import { render } from "./js/render.js";
        document.querySelector("#signIn").addEventListener("click", signIn);
        document.querySelector("#signOut").addEventListener("click", signOut);
        const main = document.querySelector("main");
        document.addEventListener("DOMContentLoaded", () => render(main));
    </script>
</head>

<body>
    <header>
        <h1>
            Grants
            <img src="favicon/android-chrome-192x192.png" alt="Grants 4 All" height="20">
            All
        </h1>
        <aside class="account-welcome">Welcome <span class="account-name"></span></aside>
        <span>
            <button type="button" id="signIn">Sign-in</button>
            <button type="button" id="signOut">Sign-out</button>
        </span>
    </header>
    <main>

    </main>
    <footer>Copyright 2021 Tangent Vision</footer>

    <template id="home">
        <aside class="splash">
            <h1>Grants 4 All</h1>
        </aside>
        <article id="please-sign-in">
            <p>
                Welcome to Grants 4 All. </p>
            <p>In order to administer or apply for grant funding, please register or login by clicking the Sign-in
                button above.</p>
        </article>
        <nav>
            <a class="tile grant-admin" href="?_=/grant_admin">
                <span class="text">Administer grants</span>
            </a>
        </nav>
    </template>

    <template id="grant_admin">
        <nav>
            <a href="?">Home</a>
        </nav>
        <section>
            <h2>Your grants</h2>
            <p>
                You don't have any grants yet.
            </p>
            <a href="?_=/create_grant" class="tile create">
                <span class="text">Create a grant</span>
            </a>
        </section>
    </template>
</body>

</html>